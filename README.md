# Server XML Integrity Checker & Sweeper

## 概要
本ツールは、IBM WAS Liberty の構成ファイル（`server.xml` や CSV設定ファイル等）に対し、運用障害の原因となる「不正文字」の除去や「Linux向け改行コード最適化」を行うサニタイズツールです。

**主なユースケース:**
Windows環境で編集された設定ファイルを、Linux環境 (WAS Liberty) へデプロイする前のクリーニング処理。

## 入出力ファイル
* **入力ファイル:** テキストファイル全般 (`.xml`, `.csv`, `.properties` など)
* **出力ファイル:** 自動修正されたファイル（必要に応じてバックアップ `.bak` を作成）
* **除外対象:** `.bak` ファイルやバイナリファイルは自動的にスキップされます。

## 検査・自動修正の対象

| 対象項目 | 挙動 | 理由・目的 |
| :--- | :--- | :--- |
| **スマートクォート**<br>(`“` `”`) | **× [VALIDATION ERROR]**<br>(要修正・処理中断) | 引用符の論理的な誤りは機械的に判断できないため、人間による修正を求めます。 |
| **NBSP**<br>(No-Break Space) | **自動置換**<br>(半角スペースへ) | 目視困難な不正スペースを除去し、構文エラーを防ぎます。 |
| **BOM**<br>(Byte Order Mark) | **自動除去** | Linux上のツールや古いパーサーでの読み込みエラーを防ぎます。 |
| **改行コード**<br>(CRLF → LF) | **拡張子に応じて変換** | 指定された拡張子（`.xml` 等）のみ **Linux形式 (LF)** に統一します。<br>※ CSV等は元の改行コードを維持します。 |

## 設定変更（改行コード変換対象）
どの拡張子をLFに変換するかは、`Check_ServerXML.ps1` 内の以下のリストで定義されています。運用に合わせて変更可能です。

    # XMLやプロパティファイルはLFにするが、CSVはCRLFのままにしたい場合の設定例
    $ExtensionsToForceLF = @(".xml", ".properties", ".jvm.options", ".env", ".sh")

## 配置
以下の2ファイルを、必ず **同じフォルダ** に配置してください。
* `Check_ServerXML.bat`
* `Check_ServerXML.ps1`

## 使用方法

### A. ドラッグ＆ドロップ (手動実行)
1. チェックしたいファイル（複数可）を選びます。
2. **`Check_ServerXML.bat` のアイコンにドラッグ＆ドロップ** します。
   ※ フォルダごとのドラッグ＆ドロップはサポートしていません。ファイルを選択してください。

### B. コマンドライン (自動化・バッチ処理)
コマンドプロンプトやPowerShellから、対象ファイルを引数として渡して実行できます。

    REM ワイルドカードを使用した一括チェック
    Check_ServerXML.bat *.xml *.csv

## 結果の判定方法
* **○ 判定: OK** : 変更不要。安全なファイルです。
* **！ 自動修正** : 不正文字や改行コードを修正し、バックアップを作成しました。
* **× [VALIDATION ERROR]** : スマートクォートを検出。**ファイルは更新されていません。** 手動修正が必要です。
* **- [SKIP]** : バックアップファイルやバイナリファイルのため、処理をスキップしました。

## バックアップと世代管理
自動修正が行われた場合のみ、以下のルールでバックアップを作成します。
* **命名規則:** `元のファイル名.yyyyMMdd_HHmmss.bak`
* **世代管理:** 最新の **5世代** を保持（古いものは自動削除）。