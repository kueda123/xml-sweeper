# server.xml 整合性チェック＆整形ツール

## 概要
本ツールは、IBM WAS (WebSphere Application Server) の構成ファイル `server.xml` に対して、構文エラーの原因となる不正文字のチェックおよび整形を行う運用補助ツールです。

WordやWeb上の記事から設定値をコピー＆ペーストした際に混入する「スマートクォート（装飾引用符）」を検出し、デプロイ前の事故（Syntax Errorによる起動失敗）を未然に防ぎます。

## 同梱ファイル
* `Check_ServerXML.bat` : 起動用バッチ（ドラッグ＆ドロップ受付）
* `Check_ServerXML.ps1` : 処理ロジック本体（PowerShell）

## 動作要件
* Windows OS (PowerShell 実行環境)

---

## 使用方法

1. **配置:**
   `Check_ServerXML.bat` と `Check_ServerXML.ps1` を同じフォルダに配置してください。

2. **実行:**
   対象の `server.xml` を、**`Check_ServerXML.bat` のアイコンにドラッグ＆ドロップ**してください。

3. **結果確認:**
   コマンドプロンプトが起動し、処理結果が表示されます。
   * **成功時:** ファイルが更新され、バックアップが作成されます。
   * **エラー時:** 赤字でエラー箇所が表示され、処理が中断されます（ファイルは更新されません）。

---

## 仕様詳細

### 1. 不正文字検知 (Pre-flight Check)
ファイル配布前に全行をスキャンし、以下の不正文字が含まれている場合は**即時エラー終了（ABORT）**します。自動置換は行いません。

* **対象文字:** スマートクォート（Smart Quotes）
    * `“` (U+201C), `”` (U+201D)
    * `‘` (U+2018), `’` (U+2019)
* **理由:**
    これらは文書作成ツールが見栄えを整えるために自動変換する文字ですが、システム側では**値（デリミタ）として認識されず、構文エラーの原因となるため**です。
    * 正: `id="abc"` (ASCII 0x22)
    * 誤: `id=“abc”` (Unicode U+201C/U+201D)

### 2. バックアップと世代管理
正常に更新が行われる場合、以下のルールで自動的にバックアップを作成します。

* **命名規則:** `server.xml.yyyyMMdd_HHmmss.bak`
* **世代管理:** 最新の **5世代** を保持します。
    * 更新時に5世代を超える古いバックアップファイルは自動的に削除されます。

### 3. ファイル更新フロー
1. 対象ファイルをメモリ上に読み込み、行単位でチェック。
2. 不正文字検知時は、ファイルへの書き込みを行わずに終了。
3. チェック通過時のみ、現行ファイルをリネーム（バックアップ）し、新ファイルを生成。

---

## 注意事項
* ツールを実行してもエラーが出る場合は、表示された行番号を確認し、テキストエディタで標準の引用符（`"` または `'`）に修正してから再度実行してください。